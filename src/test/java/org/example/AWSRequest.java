package org.example;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;
import software.amazon.awssdk.core.SdkBytes;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.lambda.LambdaClient;
import software.amazon.awssdk.services.lambda.model.InvokeRequest;
import software.amazon.awssdk.services.lambda.model.InvokeResponse;

import java.net.URI;
import java.util.HashMap;
import java.util.Map;


public class AWSRequest {

    public static void main(String[] args) throws JsonProcessingException {

        // Set up AWS credentials
        AwsBasicCredentials credentials = AwsBasicCredentials.create("AKIA2B7GNNIR3TK2ZQW5", "7W6uJJPSSncx8yVDr1HPlN+wtduhkBqoM9vcTczX");

        // Set up AWS Lambda client
        LambdaClient lambdaClient = LambdaClient.builder()
                .region(Region.EU_WEST_1)
                .credentialsProvider(() -> credentials)
                .build();

        // Create an InvokeRequest for the Lambda function
        InvokeRequest request = InvokeRequest.builder()
                .functionName("results-aggregator-develop")
                .payload(SdkBytes.fromUtf8String("{\n" +
                        "  \"body\": \"[{\\\"responseStatusCode\\\":200,\\\"clientId\\\":\\\"IAG\\\",\\\"route\\\":[{\\\"availableCapacity\\\":[{\\\"product\\\":\\\"PRIORITISE\\\",\\\"uldCapacity\\\":[{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"},{\\\"quantity\\\":2,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":2.717,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"}],\\\"volume\\\":56.5028,\\\"weight\\\":13441},{\\\"product\\\":\\\"PERFORM\\\",\\\"uldCapacity\\\":[{\\\"quantity\\\":1,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":1.717,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"},{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"}],\\\"volume\\\":30.5028,\\\"weight\\\":11791}],\\\"destination\\\":\\\"SYD\\\",\\\"dropOffTime\\\":\\\"2023-03-07T15:00:00.000Z\\\",\\\"msr\\\":[{\\\"currencyCode\\\":\\\"GBP\\\",\\\"minimumSellingRevenue\\\":13429.932075155046,\\\"product\\\":\\\"PRIORITISE\\\"},{\\\"currencyCode\\\":\\\"GBP\\\",\\\"minimumSellingRevenue\\\":10450.37033206612,\\\"product\\\":\\\"PERFORM\\\"}],\\\"origin\\\":\\\"GRU\\\",\\\"pickUpTime\\\":\\\"2023-03-10T08:25:00.000Z\\\",\\\"quote\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":11.57,\\\"costPerWeightUnit\\\":11.57,\\\"currencyCode\\\":\\\"GBP\\\",\\\"featureImportance\\\":[{\\\"name\\\":\\\"Density\\\",\\\"value\\\":0.17804335188778692},{\\\"name\\\":\\\"Min. Sell\\\",\\\"value\\\":0.1070199847048125},{\\\"name\\\":\\\"Volume\\\",\\\"value\\\":0.08136801312584095},{\\\"name\\\":\\\"AgentRoute\\\",\\\"value\\\":0.05354371312465437},{\\\"name\\\":\\\"ForwarderUpsell\\\",\\\"value\\\":0.05300782328692892}],\\\"product\\\":\\\"PRIORITISE\\\",\\\"requirements\\\":\\\"[]\\\",\\\"totalCost\\\":14682.33,\\\"weightUnit\\\":\\\"kg\\\"},{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":9.22,\\\"costPerWeightUnit\\\":9.22,\\\"currencyCode\\\":\\\"GBP\\\",\\\"featureImportance\\\":[{\\\"name\\\":\\\"Density\\\",\\\"value\\\":0.17804335188778692},{\\\"name\\\":\\\"Min. Sell\\\",\\\"value\\\":0.1070199847048125},{\\\"name\\\":\\\"Volume\\\",\\\"value\\\":0.08136801312584095},{\\\"name\\\":\\\"AgentRoute\\\",\\\"value\\\":0.05354371312465437},{\\\"name\\\":\\\"ForwarderUpsell\\\",\\\"value\\\":0.05300782328692892}],\\\"product\\\":\\\"PERFORM\\\",\\\"requirements\\\":\\\"[]\\\",\\\"totalCost\\\":11700.18,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"rate\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":16.900496453900708,\\\"costPerWeightUnit\\\":16.900496453900708,\\\"currencyCode\\\":\\\"USD\\\",\\\"offerId\\\":\\\"afb190ba-647b-4a27-9122-42d26aec2817\\\",\\\"product\\\":\\\"PRIORITISE\\\",\\\"reference\\\":\\\"BRTAC202300001\\\",\\\"surchargesIncluded\\\":{\\\"fuel\\\":0,\\\"other\\\":0},\\\"totalCost\\\":21446.73,\\\"weightUnit\\\":\\\"kg\\\"},{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":16.900496453900708,\\\"costPerWeightUnit\\\":16.900496453900708,\\\"currencyCode\\\":\\\"USD\\\",\\\"offerId\\\":\\\"46fda96d-0900-4536-8843-aa9311c98cb1\\\",\\\"product\\\":\\\"PERFORM\\\",\\\"reference\\\":\\\"BRTAC202300001\\\",\\\"surchargesIncluded\\\":{\\\"fuel\\\":0,\\\"other\\\":0},\\\"totalCost\\\":21446.73,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"routeCost\\\":{\\\"cost\\\":1413.83,\\\"currencyCode\\\":\\\"GBP\\\",\\\"margin\\\":0.2},\\\"scheduledArrivalDateTime\\\":\\\"2023-03-10T06:55:00.000Z\\\",\\\"scheduledDepartureDateTime\\\":\\\"2023-03-07T16:30:00.000Z\\\",\\\"segment\\\":[{\\\"aircraftType\\\":\\\"351\\\",\\\"arrivalDateTime\\\":\\\"2023-03-08T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"volume\\\":0,\\\"weight\\\":0},\\\"departureDateTime\\\":\\\"2023-03-07T16:30:00.000Z\\\",\\\"destination\\\":\\\"LHR\\\",\\\"flightNumber\\\":\\\"BA0246\\\",\\\"origin\\\":\\\"GRU\\\"},{\\\"aircraftType\\\":\\\"77H\\\",\\\"arrivalDateTime\\\":\\\"2023-03-10T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"volume\\\":0,\\\"weight\\\":0},\\\"departureDateTime\\\":\\\"2023-03-08T21:35:00.000Z\\\",\\\"destination\\\":\\\"SYD\\\",\\\"flightNumber\\\":\\\"BA0015\\\",\\\"origin\\\":\\\"LHR\\\"}],\\\"totalActualWeight\\\":{\\\"weight\\\":1269,\\\"weightUnit\\\":\\\"kg\\\"}},{\\\"availableCapacity\\\":[{\\\"product\\\":\\\"PRIORITISE\\\",\\\"uldCapacity\\\":[{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"},{\\\"quantity\\\":5,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":3,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"}],\\\"volume\\\":104,\\\"weight\\\":14433.48},{\\\"product\\\":\\\"PERFORM\\\",\\\"uldCapacity\\\":[{\\\"quantity\\\":4,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":2,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"},{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"}],\\\"volume\\\":78,\\\"weight\\\":12783.48}],\\\"destination\\\":\\\"SYD\\\",\\\"dropOffTime\\\":\\\"2023-03-08T15:00:00.000Z\\\",\\\"msr\\\":[{\\\"currencyCode\\\":\\\"GBP\\\",\\\"minimumSellingRevenue\\\":13429.932075155046,\\\"product\\\":\\\"PRIORITISE\\\"},{\\\"currencyCode\\\":\\\"GBP\\\",\\\"minimumSellingRevenue\\\":10485.734674066118,\\\"product\\\":\\\"PERFORM\\\"}],\\\"origin\\\":\\\"GRU\\\",\\\"pickUpTime\\\":\\\"2023-03-11T08:25:00.000Z\\\",\\\"quote\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":11.57,\\\"costPerWeightUnit\\\":11.57,\\\"currencyCode\\\":\\\"GBP\\\",\\\"featureImportance\\\":[{\\\"name\\\":\\\"Density\\\",\\\"value\\\":0.17804335188778692},{\\\"name\\\":\\\"Min. Sell\\\",\\\"value\\\":0.1070199847048125},{\\\"name\\\":\\\"Volume\\\",\\\"value\\\":0.08136801312584095},{\\\"name\\\":\\\"AgentRoute\\\",\\\"value\\\":0.05354371312465437},{\\\"name\\\":\\\"ForwarderUpsell\\\",\\\"value\\\":0.05300782328692892}],\\\"product\\\":\\\"PRIORITISE\\\",\\\"requirements\\\":\\\"[]\\\",\\\"totalCost\\\":14682.33,\\\"weightUnit\\\":\\\"kg\\\"},{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":9.25,\\\"costPerWeightUnit\\\":9.25,\\\"currencyCode\\\":\\\"GBP\\\",\\\"featureImportance\\\":[{\\\"name\\\":\\\"Density\\\",\\\"value\\\":0.17804335188778692},{\\\"name\\\":\\\"Min. Sell\\\",\\\"value\\\":0.1070199847048125},{\\\"name\\\":\\\"Volume\\\",\\\"value\\\":0.08136801312584095},{\\\"name\\\":\\\"AgentRoute\\\",\\\"value\\\":0.05354371312465437},{\\\"name\\\":\\\"ForwarderUpsell\\\",\\\"value\\\":0.05300782328692892}],\\\"product\\\":\\\"PERFORM\\\",\\\"requirements\\\":\\\"[]\\\",\\\"totalCost\\\":11738.25,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"rate\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":16.900496453900708,\\\"costPerWeightUnit\\\":16.900496453900708,\\\"currencyCode\\\":\\\"USD\\\",\\\"offerId\\\":\\\"dd93994e-a306-4863-99c6-d9cd7961902d\\\",\\\"product\\\":\\\"PRIORITISE\\\",\\\"reference\\\":\\\"BRTAC202300001\\\",\\\"surchargesIncluded\\\":{\\\"fuel\\\":0,\\\"other\\\":0},\\\"totalCost\\\":21446.73,\\\"weightUnit\\\":\\\"kg\\\"},{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":16.900496453900708,\\\"costPerWeightUnit\\\":16.900496453900708,\\\"currencyCode\\\":\\\"USD\\\",\\\"offerId\\\":\\\"9892f346-7bcd-4ded-8c1d-a03be37e5617\\\",\\\"product\\\":\\\"PERFORM\\\",\\\"reference\\\":\\\"BRTAC202300001\\\",\\\"surchargesIncluded\\\":{\\\"fuel\\\":0,\\\"other\\\":0},\\\"totalCost\\\":21446.73,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"routeCost\\\":{\\\"cost\\\":1413.83,\\\"currencyCode\\\":\\\"GBP\\\",\\\"margin\\\":0.2},\\\"scheduledArrivalDateTime\\\":\\\"2023-03-11T06:55:00.000Z\\\",\\\"scheduledDepartureDateTime\\\":\\\"2023-03-08T16:30:00.000Z\\\",\\\"segment\\\":[{\\\"aircraftType\\\":\\\"351\\\",\\\"arrivalDateTime\\\":\\\"2023-03-09T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"volume\\\":0,\\\"weight\\\":0},\\\"departureDateTime\\\":\\\"2023-03-08T16:30:00.000Z\\\",\\\"destination\\\":\\\"LHR\\\",\\\"flightNumber\\\":\\\"BA0246\\\",\\\"origin\\\":\\\"GRU\\\"},{\\\"aircraftType\\\":\\\"77H\\\",\\\"arrivalDateTime\\\":\\\"2023-03-11T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"volume\\\":0,\\\"weight\\\":0},\\\"departureDateTime\\\":\\\"2023-03-09T21:35:00.000Z\\\",\\\"destination\\\":\\\"SYD\\\",\\\"flightNumber\\\":\\\"BA0015\\\",\\\"origin\\\":\\\"LHR\\\"}],\\\"totalActualWeight\\\":{\\\"weight\\\":1269,\\\"weightUnit\\\":\\\"kg\\\"}},{\\\"availableCapacity\\\":[{\\\"product\\\":\\\"PERFORM\\\",\\\"uldCapacity\\\":[{\\\"quantity\\\":4,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":2,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"},{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"}],\\\"volume\\\":78,\\\"weight\\\":11791}],\\\"destination\\\":\\\"SYD\\\",\\\"dropOffTime\\\":\\\"2023-03-07T15:00:00.000Z\\\",\\\"msr\\\":[{\\\"currencyCode\\\":\\\"GBP\\\",\\\"minimumSellingRevenue\\\":10485.734674066118,\\\"product\\\":\\\"PERFORM\\\"}],\\\"origin\\\":\\\"GRU\\\",\\\"pickUpTime\\\":\\\"2023-03-11T08:25:00.000Z\\\",\\\"quote\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":9.25,\\\"costPerWeightUnit\\\":9.25,\\\"currencyCode\\\":\\\"GBP\\\",\\\"featureImportance\\\":[{\\\"name\\\":\\\"Density\\\",\\\"value\\\":0.17804335188778692},{\\\"name\\\":\\\"Min. Sell\\\",\\\"value\\\":0.1070199847048125},{\\\"name\\\":\\\"Volume\\\",\\\"value\\\":0.08136801312584095},{\\\"name\\\":\\\"AgentRoute\\\",\\\"value\\\":0.05354371312465437},{\\\"name\\\":\\\"ForwarderUpsell\\\",\\\"value\\\":0.05300782328692892}],\\\"product\\\":\\\"PERFORM\\\",\\\"requirements\\\":\\\"[]\\\",\\\"totalCost\\\":11738.25,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"rate\\\":[{\\\"chargeableWeight\\\":1269,\\\"costPerChargeableWeightUnit\\\":16.900496453900708,\\\"costPerWeightUnit\\\":16.900496453900708,\\\"currencyCode\\\":\\\"USD\\\",\\\"offerId\\\":\\\"5ac18f0f-a5c2-4d02-814d-5b9348ccb597\\\",\\\"product\\\":\\\"PERFORM\\\",\\\"reference\\\":\\\"BRTAC202300001\\\",\\\"surchargesIncluded\\\":{\\\"fuel\\\":0,\\\"other\\\":0},\\\"totalCost\\\":21446.73,\\\"weightUnit\\\":\\\"kg\\\"}],\\\"routeCost\\\":{\\\"cost\\\":1413.83,\\\"currencyCode\\\":\\\"GBP\\\",\\\"margin\\\":0.2},\\\"scheduledArrivalDateTime\\\":\\\"2023-03-11T06:55:00.000Z\\\",\\\"scheduledDepartureDateTime\\\":\\\"2023-03-07T16:30:00.000Z\\\",\\\"segment\\\":[{\\\"aircraftType\\\":\\\"351\\\",\\\"arrivalDateTime\\\":\\\"2023-03-08T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"uldCapacity\\\":[{\\\"quantity\\\":8,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":2,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":-3,\\\"type\\\":\\\"AKE\\\"},{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"}],\\\"volume\\\":98,\\\"weight\\\":11791},\\\"departureDateTime\\\":\\\"2023-03-07T16:30:00.000Z\\\",\\\"destination\\\":\\\"LHR\\\",\\\"flightNumber\\\":\\\"BA0246\\\",\\\"origin\\\":\\\"GRU\\\"},{\\\"aircraftType\\\":\\\"77H\\\",\\\"arrivalDateTime\\\":\\\"2023-03-11T06:55:00.000Z\\\",\\\"availableSegmentCapacity\\\":{\\\"uldCapacity\\\":[{\\\"quantity\\\":4,\\\"type\\\":\\\"PMP\\\"},{\\\"quantity\\\":2,\\\"type\\\":\\\"PAG\\\"},{\\\"quantity\\\":3,\\\"type\\\":\\\"AKE\\\"},{\\\"quantity\\\":0,\\\"type\\\":\\\"BLK\\\"}],\\\"volume\\\":78,\\\"weight\\\":24455},\\\"departureDateTime\\\":\\\"2023-03-09T21:35:00.000Z\\\",\\\"destination\\\":\\\"SYD\\\",\\\"flightNumber\\\":\\\"BA0015\\\",\\\"origin\\\":\\\"LHR\\\"}],\\\"totalActualWeight\\\":{\\\"weight\\\":1269,\\\"weightUnit\\\":\\\"kg\\\"}}]}]\",\n" +
                        "  \"headers\": {\"ba_client_applicationName\": \"RogerE\"},\n" +
                        "  \"queryStringParameters\": {},\n" +
                        "  \"requestContext\": {\n" +
                        "    \"http\": {\n" +
                        "      \"method\": \"POST\",\n" +
                        "      \"path\": \"/interlinehub/availableroutes\"\n" +
                        "    }\n" +
                        "  }\n" +
                        "}"))  // Set the payload as required by your Lambda function
                .build();

        // Invoke the Lambda function
        InvokeResponse response = lambdaClient.invoke(request);

        // Process the response
        String resultPayload = response.payload().asUtf8String();
        System.out.println("Lambda function response: " + resultPayload);

//        ObjectMapper objectMapper = new ObjectMapper();
//        HashMap<String, String> hashMap = (HashMap<String, String>) objectMapper.readValue(resultPayload, new TypeReference<Map<String, String>>() {
//        });
//        String key = "statusCode";
//        String value = hashMap.get(key);
//
//        // Print the value
//        System.out.println("Value for key '" + key + "': " + value);


    }
}
